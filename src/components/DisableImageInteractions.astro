---
---

<script is:inline>
  (() => {
    const isImageTarget = (target) => {
      return target instanceof Element && Boolean(target.closest('img'));
    };

    const blockImageEvent = (event) => {
      if (isImageTarget(event.target)) {
        event.preventDefault();
      }
    };

    const markImagesUndraggable = () => {
      document.querySelectorAll('img').forEach((img) => {
        if (!img.hasAttribute('draggable')) {
          img.setAttribute('draggable', 'false');
        }
      });
    };

    document.addEventListener('contextmenu', blockImageEvent);
    document.addEventListener('dragstart', blockImageEvent);

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', markImagesUndraggable, { once: true });
    } else {
      markImagesUndraggable();
    }

    const observer = new MutationObserver((mutations) => {
      for (const mutation of mutations) {
        if (mutation.addedNodes.length > 0) {
          markImagesUndraggable();
          break;
        }
      }
    });

    observer.observe(document.documentElement, {
      childList: true,
      subtree: true,
    });
  })();
</script>
