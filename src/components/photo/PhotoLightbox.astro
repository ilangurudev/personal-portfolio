---
import PhotoIcons from './PhotoIcons.astro';
import { getPhotoUrl } from '../../utils/url-helper';

interface Props {
  photos: Array<{
    id: string;
    data: {
      title: string;
      filename: string;
      album?: string;
      tags?: string[];
      camera?: string;
      settings?: string;
      focalLength?: number;
      location?: string;
    };
  }>;
  initialIndex?: number;
}

const { photos, initialIndex = 0 } = Astro.props;
---

<PhotoIcons />

<div id="photo-lightbox" class="lightbox" style="display: none;">
  <div class="lightbox-backdrop"></div>
  <div class="shutter-overlay"></div>
  <button class="lightbox-close" aria-label="Close lightbox">×</button>
  
  <div class="lightbox-content">
    <button class="lightbox-nav lightbox-prev" aria-label="Previous photo">‹</button>
    <div class="lightbox-image-container">
      <img class="lightbox-image" src="" alt="" />
      <div class="lightbox-info">
        <div class="lightbox-tags-and-album">
          <div class="lightbox-album"></div>
          <div class="lightbox-tags"></div>
        </div>
        <div class="lightbox-metadata-row">
          <div class="lightbox-metadata"></div>
          <div class="lightbox-counter"></div>
        </div>
      </div>
    </div>
    <button class="lightbox-nav lightbox-next" aria-label="Next photo">›</button>
  </div>
</div>

<script>
  const STANDARD_FOCAL_LENGTHS = [10, 14, 16, 18, 20, 24, 28, 35, 40, 50, 60, 70, 100, 120, 150, 180, 200];

  interface Photo {
    id: string;
    url: string;
    data: {
      title: string;
      filename: string;
      album?: string;
      tags?: string[];
      camera?: string;
      settings?: string;
      focalLength?: number;
      location?: string;
    };
  }

  class PhotoLightbox {
    private lightbox: HTMLElement | null;
    private image: HTMLImageElement | null;
    private tags: HTMLElement | null;
    private album: HTMLElement | null;
    private metadata: HTMLElement | null;
    private counter: HTMLElement | null;
    private photos: Photo[];
    private currentIndex: number;
    private isOpen: boolean = false;
    private touchStartX: number = 0;
    private touchEndX: number = 0;
    private touchStartY: number = 0;
    private touchEndY: number = 0;
    private isSwiping: boolean = false;
    private shutterOverlay: HTMLElement | null;

    constructor(photos: Photo[]) {
      this.photos = photos;
      this.currentIndex = 0;
      this.lightbox = document.getElementById('photo-lightbox');
      this.shutterOverlay = this.lightbox?.querySelector('.shutter-overlay') as HTMLElement;
      this.image = this.lightbox?.querySelector('.lightbox-image') as HTMLImageElement;
      this.tags = this.lightbox?.querySelector('.lightbox-tags') as HTMLElement;
      this.album = this.lightbox?.querySelector('.lightbox-album') as HTMLElement;
      this.metadata = this.lightbox?.querySelector('.lightbox-metadata') as HTMLElement;
      this.counter = this.lightbox?.querySelector('.lightbox-counter') as HTMLElement;

      this.init();
    }

    private init() {
      if (!this.lightbox) return;

      // Close button
      const closeBtn = this.lightbox.querySelector('.lightbox-close');
      closeBtn?.addEventListener('click', () => this.close());

      // Backdrop click
      const backdrop = this.lightbox.querySelector('.lightbox-backdrop');
      backdrop?.addEventListener('click', () => this.close());

      // Navigation buttons
      const prevBtn = this.lightbox.querySelector('.lightbox-prev');
      const nextBtn = this.lightbox.querySelector('.lightbox-next');
      prevBtn?.addEventListener('click', () => this.prev());
      nextBtn?.addEventListener('click', () => this.next());

      // Keyboard navigation
      document.addEventListener('keydown', (e) => this.handleKeydown(e));

      // Touch navigation for swipe gestures
      const imageContainer = this.lightbox.querySelector('.lightbox-image-container');
      if (imageContainer) {
        imageContainer.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: true });
        imageContainer.addEventListener('touchmove', (e) => this.handleTouchMove(e), { passive: true });
        imageContainer.addEventListener('touchend', (e) => this.handleTouchEnd(e), { passive: true });
      }

      // Prevent body scroll when open
      this.lightbox.addEventListener('transitionend', () => {
        if (this.isOpen) {
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = '';
        }
      });
    }

    private handleKeydown(e: KeyboardEvent) {
      if (!this.isOpen) return;

      switch (e.key) {
        case 'Escape':
          this.close();
          break;
        case 'ArrowLeft':
          this.prev();
          break;
        case 'ArrowRight':
          this.next();
          break;
      }
    }

    private handleTouchStart(e: TouchEvent) {
      if (!this.isOpen) return;

      this.touchStartX = e.touches[0].clientX;
      this.touchStartY = e.touches[0].clientY;
      this.isSwiping = false;
    }

    private handleTouchMove(e: TouchEvent) {
      if (!this.isOpen) return;

      this.touchEndX = e.touches[0].clientX;
      this.touchEndY = e.touches[0].clientY;

      // Calculate the distance moved
      const deltaX = Math.abs(this.touchEndX - this.touchStartX);
      const deltaY = Math.abs(this.touchEndY - this.touchStartY);

      // If horizontal movement is greater than vertical, it's a swipe
      if (deltaX > deltaY && deltaX > 10) {
        this.isSwiping = true;
      }
    }

    private handleTouchEnd(e: TouchEvent) {
      if (!this.isOpen || !this.isSwiping) return;

      const deltaX = this.touchEndX - this.touchStartX;
      const deltaY = Math.abs(this.touchEndY - this.touchStartY);
      const swipeThreshold = 50; // Minimum distance for a swipe

      // Only trigger navigation if horizontal swipe is greater than vertical movement
      if (Math.abs(deltaX) > swipeThreshold && Math.abs(deltaX) > deltaY) {
        if (deltaX > 0) {
          // Swipe right - go to previous photo
          this.prev();
        } else {
          // Swipe left - go to next photo
          this.next();
        }
      }

      // Reset values
      this.touchStartX = 0;
      this.touchEndX = 0;
      this.touchStartY = 0;
      this.touchEndY = 0;
      this.isSwiping = false;
    }

    public open(index: number) {
      if (index < 0 || index >= this.photos.length) return;
      
      this.currentIndex = index;
      this.isOpen = true;
      this.updateImage();
      
      if (this.lightbox) {
        this.lightbox.style.display = 'flex';
        // Trigger reflow for animation
        requestAnimationFrame(() => {
          this.lightbox?.classList.add('active');
          
          // Shutter animation
          if (this.shutterOverlay) {
            this.shutterOverlay.style.animation = 'none';
            this.shutterOverlay.offsetHeight; // trigger reflow
            this.shutterOverlay.style.animation = 'shutterClick 0.3s ease-in-out';
          }
        });
      }
    }

    public close() {
      this.isOpen = false;
      if (this.lightbox) {
        this.lightbox.classList.remove('active');
        // Hide after animation
        setTimeout(() => {
          if (this.lightbox && !this.isOpen) {
            this.lightbox.style.display = 'none';
          }
        }, 300);
      }
      document.body.style.overflow = '';
    }

    public next() {
      const nextIndex = (this.currentIndex + 1) % this.photos.length;
      this.open(nextIndex);
    }

    public prev() {
      const prevIndex = (this.currentIndex - 1 + this.photos.length) % this.photos.length;
      this.open(prevIndex);
    }

    private updateImage() {
      const photo = this.photos[this.currentIndex];
      if (!photo || !this.image) return;

      // Preload next and previous images
      this.preloadAdjacent();

      // Update current image
      this.image.src = photo.url;
      this.image.alt = photo.data.title;

      // Update tags
      if (this.tags) {
        if (photo.data.tags && Array.isArray(photo.data.tags) && photo.data.tags.length > 0) {
          const tagsHTML = photo.data.tags
            .map(tag => {
              const encodedTag = encodeURIComponent(tag);
              return `<span class="lightbox-tag" data-tag="${encodedTag}" style="display: inline-block; font-size: 0.75rem; color: rgba(255, 251, 245, 0.95); background: rgba(160, 160, 160, 0.6); padding: 0.375rem 0.75rem; border-radius: 14px; font-weight: 400; letter-spacing: 0.02em; cursor: pointer; transition: all 0.2s ease; user-select: none; border: 1px solid rgba(255, 255, 255, 0.2); white-space: nowrap; opacity: 1; visibility: visible;">#${tag.toLowerCase()}</span>`;
            })
            .join('');
          this.tags.innerHTML = tagsHTML;
          this.tags.style.display = 'flex';
          this.tags.style.visibility = 'visible';
          
          // Add click handlers to tags
          setTimeout(() => {
            this.tags?.querySelectorAll('.lightbox-tag').forEach(tagEl => {
              const el = tagEl as HTMLElement;
              el.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                const tag = el.getAttribute('data-tag');
                if (tag) {
                  window.location.href = `/photography/tag/${tag}`;
                }
              });
              el.addEventListener('mouseenter', () => {
                el.style.background = 'rgba(180, 180, 180, 0.8)';
                el.style.color = 'rgba(255, 251, 245, 1)';
                el.style.transform = 'translateY(-1px)';
                el.style.borderColor = 'rgba(255, 255, 255, 0.4)';
              });
              el.addEventListener('mouseleave', () => {
                el.style.background = 'rgba(160, 160, 160, 0.6)';
                el.style.color = 'rgba(255, 251, 245, 0.95)';
                el.style.transform = 'translateY(0)';
                el.style.borderColor = 'rgba(255, 255, 255, 0.2)';
              });
            });
          }, 0);
        } else {
          this.tags.style.display = 'none';
          this.tags.style.visibility = 'hidden';
        }
      }

      // Update album
      if (this.album) {
        if (photo.data.album && photo.data.album.trim()) {
          const folderIcon = this.getIconSVG('icon-folder');
          const albumSlug = photo.data.album;
          // Format album slug for display (replace hyphens with spaces, capitalize)
          const albumDisplay = albumSlug.split('-').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1)
          ).join(' ');
          
          this.album.innerHTML = `<span class="lightbox-album-link" data-album="${albumSlug}" style="display: inline-flex; align-items: center; font-size: 0.75rem; color: rgba(255, 251, 245, 0.95); background: rgba(160, 160, 160, 0.6); padding: 0.375rem 0.75rem; border-radius: 14px; font-weight: 400; letter-spacing: 0.02em; cursor: pointer; transition: all 0.2s ease; user-select: none; border: 1px solid rgba(255, 255, 255, 0.2); white-space: nowrap; opacity: 1; visibility: visible; gap: 0.375rem;">${folderIcon}<span>${albumDisplay}</span></span>`;
          this.album.style.display = 'flex';
          this.album.style.visibility = 'visible';
          
          // Add click handler to album
          setTimeout(() => {
            const albumLink = this.album?.querySelector('.lightbox-album-link');
            if (albumLink) {
              const el = albumLink as HTMLElement;
              el.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                const album = el.getAttribute('data-album');
                if (album) {
                  window.location.href = `/photography/album/${album}`;
                }
              });
              el.addEventListener('mouseenter', () => {
                el.style.background = 'rgba(180, 180, 180, 0.8)';
                el.style.color = 'rgba(255, 251, 245, 1)';
                el.style.transform = 'translateY(-1px)';
                el.style.borderColor = 'rgba(255, 255, 255, 0.4)';
              });
              el.addEventListener('mouseleave', () => {
                el.style.background = 'rgba(160, 160, 160, 0.6)';
                el.style.color = 'rgba(255, 251, 245, 0.95)';
                el.style.transform = 'translateY(0)';
                el.style.borderColor = 'rgba(255, 255, 255, 0.2)';
              });
            }
          }, 0);
        } else {
          this.album.style.display = 'none';
          this.album.style.visibility = 'hidden';
        }
      }

      // Update metadata
      if (this.metadata) {
        const metadataItems: string[] = [];
        
        if (photo.data.camera) {
          const cameraIcon = this.getIconSVG('icon-camera');
          metadataItems.push(`<div class="lightbox-metadata-item">${cameraIcon}<span>${photo.data.camera}</span></div>`);
        }
        
        if (photo.data.settings) {
          // Parse settings to extract f-stop, shutter, ISO if possible
          const settingsIcon = this.getIconSVG('icon-aperture');
          metadataItems.push(`<div class="lightbox-metadata-item">${settingsIcon}<span>${photo.data.settings}</span></div>`);
        }

        const focalLengthDisplay = this.getRoundedFocalLength(photo.data.focalLength);
        if (focalLengthDisplay) {
          const focalIcon = this.getIconSVG('icon-focal');
          metadataItems.push(`<div class="lightbox-metadata-item">${focalIcon}<span>${focalLengthDisplay}</span></div>`);
        }
        
        if (photo.data.location && photo.data.location.trim()) {
          const locationTrimmed = photo.data.location.trim();
          const locationLower = locationTrimmed.toLowerCase();
          // Don't show location if it contains NaN or is exactly "na" (invalid coordinates)
          const hasInvalidCoords = locationLower.includes('nan') || locationLower === 'na';
          if (!hasInvalidCoords) {
            const locationIcon = this.getIconSVG('icon-location');
            metadataItems.push(`<div class="lightbox-metadata-item">${locationIcon}<span>${locationTrimmed}</span></div>`);
          }
        }
        
        if (metadataItems.length > 0) {
          this.metadata.innerHTML = metadataItems.join('');
          this.metadata.style.display = 'flex';
        } else {
          this.metadata.style.display = 'none';
        }
      }

      // Update counter (styled like film frame number) - moved inline with metadata
      if (this.counter) {
        this.counter.textContent = `${this.currentIndex + 1} / ${this.photos.length}`;
      }
    }

    private getIconSVG(iconId: string): string {
      const template = document.getElementById(iconId);
      if (!template) {
        console.warn(`Icon ${iconId} not found in DOM`);
        return '';
      }
      
      const clone = template.cloneNode(true) as SVGElement;
      clone.removeAttribute('id');
      clone.removeAttribute('style');
      clone.classList.add('photo-icon-inline');
      clone.setAttribute('width', '16');
      clone.setAttribute('height', '16');
      clone.setAttribute('fill', 'none');
      clone.setAttribute('stroke', 'currentColor');
      clone.style.display = 'inline-block';
      clone.style.verticalAlign = 'middle';
      clone.style.marginRight = '0.5rem';
      clone.style.color = 'currentColor';
      
      // Get the SVG content as a string
      const serializer = new XMLSerializer();
      const svgString = serializer.serializeToString(clone);
      return svgString;
    }

    private preloadAdjacent() {
      const nextIndex = (this.currentIndex + 1) % this.photos.length;
      const prevIndex = (this.currentIndex - 1 + this.photos.length) % this.photos.length;

      const nextPhoto = this.photos[nextIndex];
      const prevPhoto = this.photos[prevIndex];

      if (nextPhoto) {
        const nextImg = new Image();
        nextImg.src = nextPhoto.url;
      }

      if (prevPhoto) {
        const prevImg = new Image();
        prevImg.src = prevPhoto.url;
      }
    }

    private getRoundedFocalLength(value?: number): string | null {
      if (typeof value !== 'number' || !Number.isFinite(value) || value <= 0) {
        return null;
      }

      if (value > 200) {
        const roundedHundreds = Math.round(value / 100) * 100;
        return `${Math.max(200, roundedHundreds)}mm`;
      }

      let closest = STANDARD_FOCAL_LENGTHS[0];
      let smallestDiff = Math.abs(value - closest);

      for (const candidate of STANDARD_FOCAL_LENGTHS) {
        const diff = Math.abs(value - candidate);
        if (diff < smallestDiff || (diff === smallestDiff && candidate > closest)) {
          closest = candidate;
          smallestDiff = diff;
        }
      }

      return `${closest}mm`;
    }
  }

  // Initialize lightbox after DOM is ready
  function initLightbox() {
    const photosDataElement = document.getElementById('photos-data');
    if (!photosDataElement) return;

    const photosData: Photo[] = JSON.parse(photosDataElement.textContent || '[]');
    if (photosData.length === 0) return;

    const lightbox = new PhotoLightbox(photosData);

    // Make lightbox accessible globally for photo cards
    (window as any).photoLightbox = lightbox;

    // Handle photo card clicks
    document.addEventListener('click', (e) => {
      const card = (e.target as HTMLElement).closest('.photo-card[data-photo-id]');
      if (!card) return;

      e.preventDefault();
      
      // Trigger focus lock animation
      const viewfinder = card.querySelector('.viewfinder-corners');
      if (viewfinder) {
        viewfinder.classList.add('focus-locked');
        // Reset after animation
        setTimeout(() => {
          viewfinder.classList.remove('focus-locked');
        }, 1000);
      }
      
      const photoId = card.getAttribute('data-photo-id');
      if (!photoId) return;

      const index = photosData.findIndex(p => p.id === photoId);
      if (index !== -1) {
        // Small delay to let the focus lock animation be seen before lightbox opens
        setTimeout(() => {
          lightbox.open(index);
        }, 200);
      }
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLightbox);
  } else {
    initLightbox();
  }
</script>

<script id="photos-data" type="application/json" set:html={JSON.stringify(photos.map(p => ({
  id: p.id,
  url: getPhotoUrl(p.data.filename),
  data: {
    title: p.data.title,
    filename: p.data.filename,
    album: p.data.album,
    tags: p.data.tags || [],
    camera: p.data.camera,
    settings: p.data.settings,
    focalLength: p.data.focalLength,
    location: p.data.location
  }
})))}></script>

<style is:global>
  .lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .lightbox.active {
    opacity: 1;
    visibility: visible;
  }

  .lightbox-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(28, 25, 23, 0.95);
    backdrop-filter: blur(8px);
  }

  .shutter-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 10005;
    pointer-events: none;
    opacity: 0;
  }

  @keyframes shutterClick {
    0% { opacity: 0; }
    10% { opacity: 1; }
    40% { opacity: 1; }
    100% { opacity: 0; }
  }

  /* Film grain texture */
  .lightbox-backdrop::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.03;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
  }

  .lightbox-close {
    position: absolute;
    top: 2rem;
    right: 2rem;
    width: 48px;
    height: 48px;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    color: var(--cream);
    font-size: 2rem;
    font-weight: 300;
    cursor: pointer;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10001;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .lightbox-close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
  }

  .lightbox-content {
    position: relative;
    z-index: 10000;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    max-width: 1600px;
  }

  .lightbox-image-container {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0;
  }

  .lightbox-image {
    max-width: 100%;
    max-height: calc(100vh - 140px);
    width: auto;
    height: auto;
    object-fit: contain;
    border-radius: 4px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: fadeInScale 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .lightbox-info {
    margin-top: 1.5rem;
    text-align: center;
    color: var(--cream);
    max-width: 800px;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
  }

  .lightbox-metadata-row {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
    font-size: 0.875rem;
    color: rgba(255, 251, 245, 0.7);
  }

  .lightbox-metadata {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
  }

  .lightbox-metadata-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .lightbox-metadata-item .photo-icon-inline {
    width: 16px;
    height: 16px;
    opacity: 0.8;
  }

  .lightbox-metadata-item span {
    font-weight: 400;
    letter-spacing: 0.02em;
  }

  .lightbox-tags-and-album {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
    align-items: center;
    width: 100%;
  }

  .lightbox-tags {
    display: flex !important;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
    visibility: visible !important;
    opacity: 1 !important;
    min-height: 1.5rem;
  }

  .lightbox-album {
    display: flex;
    align-items: center;
    justify-content: center;
    visibility: visible !important;
    opacity: 1 !important;
  }

  .lightbox-album-link {
    display: inline-flex !important;
    align-items: center;
    gap: 0.375rem;
  }

  .lightbox-album-link .photo-icon-inline {
    width: 14px;
    height: 14px;
    margin-right: 0;
  }

  .lightbox-tag {
    display: inline-block !important;
    font-size: 0.75rem;
    color: rgba(255, 251, 245, 0.95) !important;
    background: rgba(160, 160, 160, 0.6) !important;
    padding: 0.375rem 0.75rem;
    border-radius: 14px;
    font-weight: 400;
    letter-spacing: 0.02em;
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
    border: 1px solid rgba(255, 255, 255, 0.2);
    white-space: nowrap;
    opacity: 1 !important;
    visibility: visible !important;
  }

  .lightbox-tag:hover {
    background: rgba(180, 180, 180, 0.8) !important;
    color: rgba(255, 251, 245, 1) !important;
    transform: translateY(-1px);
    border-color: rgba(255, 255, 255, 0.4);
  }

  .lightbox-tag:active {
    transform: translateY(0);
  }

  .lightbox-counter {
    font-size: 0.875rem;
    color: rgba(255, 251, 245, 0.7);
    font-weight: 400;
    letter-spacing: 0.05em;
    font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: inline-block;
  }

  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 56px;
    height: 56px;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    color: var(--cream);
    font-size: 2.5rem;
    font-weight: 300;
    cursor: pointer;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10001;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    line-height: 1;
  }

  .lightbox-nav:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-50%) scale(1.1);
  }

  .lightbox-prev {
    left: 2rem;
  }

  .lightbox-next {
    right: 2rem;
  }

  @media (max-width: 768px) {
    .lightbox-close {
      top: 1rem;
      right: 1rem;
      width: 40px;
      height: 40px;
      font-size: 1.5rem;
    }

    .lightbox-content {
      padding: 1rem;
    }

    .lightbox-image {
      max-height: calc(100vh - 180px);
    }

    .lightbox-nav {
      width: 44px;
      height: 44px;
      font-size: 2rem;
    }

    .lightbox-prev {
      left: 0.5rem;
    }

    .lightbox-next {
      right: 0.5rem;
    }

    .lightbox-info {
      margin-top: 1.5rem;
    }
  }

  @media (max-width: 480px) {
    .lightbox-nav {
      width: 36px;
      height: 36px;
      font-size: 1.5rem;
    }

  }
</style>

