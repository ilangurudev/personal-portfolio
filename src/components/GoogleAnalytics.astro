---
// Google Analytics 4 (GA4) Component
// Uses gtag.js for modern tracking
// Requires PUBLIC_GA_MEASUREMENT_ID environment variable

const gaMeasurementId = import.meta.env.PUBLIC_GA_MEASUREMENT_ID;

// Only render if GA Measurement ID is provided
if (!gaMeasurementId) {
  return null;
}
---

<!-- Preconnect to Google Analytics domains for better performance -->
<link rel="preconnect" href="https://www.googletagmanager.com" />
<link rel="preconnect" href="https://www.google-analytics.com" />

<!-- Google tag (gtag.js) -->
<script async src={`https://www.googletagmanager.com/gtag/js?id=${gaMeasurementId}`}></script>
<script is:inline define:vars={{ gaMeasurementId }}>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', gaMeasurementId, {
    // Respect user privacy preferences
    anonymize_ip: true,
  });
</script>
